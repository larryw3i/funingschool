{% extends "base/header_content_footer.html" %}
{% load crispy_forms_tags %}
{% block title %}
  {% trans "Consume Ingredients" %}
{% endblock %}
{% block content %}
  <h1>{% trans "Consume Ingredients." %}</h1>
  <hr>
  <div class="table table-responsive table-container">
    <table class="table table-consumptions cotable-bordered table-striped table-hover table-condensed scroll-vertical ">
      <thead>
        <tr>
          <th class="">#</th>
          <th class="">#</th>
          {% for date_h in date_range %}<th>{{ date_h }}</th>{% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for ingredient in ingredients %}
          <tr data-ingredient-name="{{ ingredient.name }}"
              data-ingredient-quantity="{{ ingredient.quantity }}"
              data-total-price="{{ ingredient.total_price }}"
              data-ingredient-quantity_unit_name="{{ ingredient.quantity_unit_name }}"
              id="ingredient_num_{{ ingredient.id }}">
            <td>{{ ingredient.name }}</td>
            <td name="remaining_{{ ingredient.id }}"></td>
          </tr>
          <script>
            $(function() {
              $.ajax(
                {
                  url:"{% url 'canteen:create_consumption' ingredient.id %}",
                  method: 'GET',
                  success: function(data){
                    $('#ingredient_num_{{ ingredient.id }}').append(data)
                  }
                }
              )
            });

          </script>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script>
    function set_consumptions_table_size(){
      const consumptions_table=$(".table-consumptions")
      const header=$("header")
      const footer=$("footer")
      const height = Math.round((footer.offset().top-consumptions_table.offset().top )*0.96)
        consumptions_table.parent().height(height)
    }
    $(window).resize(function() {
      set_consumptions_table_size()
    });
    $(document).ready(function() {
      set_consumptions_table_size()
});
  </script>
  <style>
body{
}
.table-container {
  overflow:auto;
}
  .table thead th {
      position: -webkit-sticky; 
      position: sticky;
      top: 0; 
      z-index: 1020; 
  }

 .table tr > :nth-child(1) {
      position: -webkit-sticky; 
      position: sticky;
      left: 0; 
      z-index: 1020; 
  }

  .table tr > :nth-child(2) {
      position: -webkit-sticky; 
      position: sticky;
      left: 50px; 
      z-index: 1020; 
  }
   .table thead tr > :nth-child(1) {
      z-index: 1020; 
  }
  .table thead tr > :nth-child(2) {
      z-index: 1020; 
      left:50px;
  }

  </style>
{% endblock %}
